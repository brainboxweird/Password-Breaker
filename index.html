<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Password Breaker — Playable on GitHub Pages</title>
  <style>
    :root{
      --bg:#0f1724;
      --card:#0b1220;
      --muted:#9aa6bb;
      --accent:#22c55e;
      --warn:#f59e0b;
      --danger:#ef4444;
      --glass: rgba(255,255,255,0.04);
      font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:linear-gradient(180deg,#071024 0%, #07172a 60%);
      color:#e6eef8;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
      gap:20px;
    }
    .container{
      width:100%;
      max-width:980px;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:12px;
      padding:20px;
      box-shadow: 0 10px 30px rgba(2,6,23,0.6);
      display:grid;
      grid-template-columns: 360px 1fr;
      gap:18px;
    }
    header{display:flex;align-items:center;gap:12px}
    h1{margin:0;font-size:20px}
    p.lead{margin:6px 0 0;color:var(--muted);font-size:13px}

    .panel{
      background:var(--card);
      border-radius:10px;
      padding:14px;
    }
    .controls{display:flex;flex-direction:column;gap:10px}
    label{font-size:13px;color:var(--muted);display:flex;justify-content:space-between;align-items:center}
    select,input[type="number"]{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    .btn{
      display:inline-flex;align-items:center;justify-content:center;gap:8px;
      padding:10px 12px;border-radius:8px;border:none;cursor:pointer;
      background:linear-gradient(180deg,#1f2937,#111827);color:#e7eef8;font-weight:600;
    }
    .row{display:flex;gap:8px}
    .muted{color:var(--muted);font-size:13px}
    .game-area{display:flex;flex-direction:column;gap:12px}
    .attempts{display:flex;flex-direction:column;gap:8px;max-height:420px;overflow:auto;padding-right:6px}
    .attempt{
      display:flex;gap:8px;align-items:center;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,monospace;
    }
    .key{
      width:42px;height:42px;border-radius:8px;display:inline-grid;place-items:center;
      background:var(--glass);color:var(--muted);font-weight:700;border:1px solid rgba(255,255,255,0.02)
    }
    .green{background:linear-gradient(180deg,#2a8f5f,#1f7a4f);color:white;border:none}
    .yellow{background:linear-gradient(180deg,#f4a81b,#d98f16);color:#121212;border:none}
    .gray{background:linear-gradient(180deg,#1f2937,#0f1724);color:var(--muted);border:none}
    .hint{font-size:13px;color:var(--muted)}
    .footer{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-top:8px}
    .stats{display:flex;gap:10px;align-items:center;color:var(--muted);font-size:13px}
    .kbd{background:rgba(255,255,255,0.03);padding:6px 8px;border-radius:6px;font-size:12px;color:var(--muted)}

    /* responsive */
    @media (max-width:900px){
      .container{grid-template-columns:1fr; padding:16px}
      .panel{padding:12px}
    }
    /* accessibility focus */
    button:focus, input:focus, select:focus {outline:3px solid rgba(66,153,225,0.12);outline-offset:2px}
  </style>
</head>
<body>
  <div class="container" role="application" aria-labelledby="title">
    <div>
      <header>
        <div>
          <h1 id="title">Password Breaker</h1>
          <p class="lead">Guess the hidden password. Each guess gives feedback: green = right letter & position, yellow = letter present but wrong position.</p>
        </div>
      </header>

      <div class="panel" style="margin-top:12px">
        <div class="controls">
          <label>Difficulty
            <select id="difficulty" aria-label="Select difficulty">
              <option value="easy">Easy — 4 lowercase letters</option>
              <option value="medium">Medium — 5 letters + digits</option>
              <option value="hard">Hard — 6 mixed + symbols</option>
            </select>
          </label>

          <label>Max Attempts <span class="muted" id="maxAttemptsLabel">8</span>
            <input id="maxAttempts" type="range" min="4" max="12" value="8" aria-label="Maximum attempts slider" />
          </label>

          <div class="row">
            <button class="btn" id="newGameBtn">New Game</button>
            <button class="btn" id="revealBtn" title="Reveal password (counts as a loss)">Reveal</button>
          </div>

          <div class="hint" id="hintLine">Hint: Choose a difficulty and start guessing.</div>

          <div class="footer">
            <div class="stats">
              <span>Games: <strong id="gamesPlayed">0</strong></span>
              <span>Wins: <strong id="gamesWon">0</strong></span>
              <span>Best: <strong id="bestScore">—</strong></span>
            </div>
            <div class="muted">Tip: press Enter to submit a guess</div>
          </div>
        </div>
      </div>

      <div style="margin-top:12px;text-align:center">
        <small class="muted">This game is client-only and works on GitHub Pages. No data leaves your browser.</small>
      </div>
    </div>

    <div>
      <div class="panel game-area">
        <div style="display:flex;gap:8px;align-items:center">
          <label style="flex:1">
            <div class="muted" style="margin-bottom:6px">Enter guess</div>
            <input id="guessInput" type="text" inputmode="latin" placeholder="Type your guess and press Enter" aria-label="Guess input" autocomplete="off" />
          </label>
          <div style="display:flex;flex-direction:column;gap:8px">
            <button class="btn" id="submitBtn">Guess</button>
            <div class="kbd" id="attemptsLeft">8 left</div>
          </div>
        </div>

        <div class="attempts" id="attemptsList" aria-live="polite" aria-atomic="true" style="margin-top:10px">
          <!-- guesses will appear here -->
        </div>

        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:6px">
          <div class="muted" id="passwordInfo">Password length: —</div>
          <div style="display:flex;gap:8px">
            <button class="btn" id="copyStateBtn" title="Copy current game state as text">Copy state</button>
            <button class="btn" id="resetStatsBtn" title="Reset stats">Reset stats</button>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
(() => {
  // Utility functions
  const el = id => document.getElementById(id);
  const rand = n => Math.floor(Math.random()*n);

  // Character pools
  const pools = {
    easy: 'abcdefghijklmnopqrstuvwxyz',
    medium: 'abcdefghijklmnopqrstuvwxyz0123456789',
    hard: 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()-_=+[]{};:,.<>/?'
  };

  // Game state
  let secret = '';
  let difficulty = 'easy';
  let maxAttempts = 8;
  let attempts = [];
  let finished = false;

  // Stats in localStorage
  const STATS_KEY = 'pwbreaker_stats_v1';
  const readStats = () => JSON.parse(localStorage.getItem(STATS_KEY) || '{"played":0,"won":0,"best":null}');
  const writeStats = s => localStorage.setItem(STATS_KEY, JSON.stringify(s));
  const stats = readStats();
  function refreshStatsUI(){
    el('gamesPlayed').textContent = stats.played;
    el('gamesWon').textContent = stats.won;
    el('bestScore').textContent = stats.best === null ? '—' : stats.best;
  }

  // Generate secret based on difficulty
  function genSecret(diff){
    const pool = pools[diff];
    const len = diff === 'easy' ? 4 : diff === 'medium' ? 5 : 6;
    let s = '';
    for(let i=0;i<len;i++) s += pool[rand(pool.length)];
    return s;
  }

  function resetGame(opts = {}){
    difficulty = opts.diff || el('difficulty').value || difficulty;
    maxAttempts = parseInt(el('maxAttempts').value,10) || 8;
    secret = genSecret(difficulty);
    attempts = [];
    finished = false;
    el('attemptsList').innerHTML = '';
    el('guessInput').value = '';
    el('hintLine').textContent = `Password generated (${difficulty}). Use letters, digits, and symbols depending on difficulty.`;
    el('passwordInfo').textContent = `Password length: ${secret.length}`;
    el('attemptsLeft').textContent = `${maxAttempts} left`;
    el('maxAttemptsLabel').textContent = maxAttempts;
    el('revealBtn').disabled = false;
    renderAttempts();
    // For debug: console.log('secret', secret);
  }

  // Evaluate a guess and return an array of marks: 'green', 'yellow', 'gray'
  function evaluateGuess(guess, secret){
    const result = Array(guess.length).fill('gray');
    const secretArr = secret.split('');
    const used = Array(secret.length).fill(false);

    // First pass: greens
    for(let i=0;i<guess.length;i++){
      if(guess[i] === secret[i]){ result[i] = 'green'; used[i]=true; }
    }
    // Second pass: yellows
    for(let i=0;i<guess.length;i++){
      if(result[i] === 'green') continue;
      const idx = secretArr.findIndex((ch, j) => !used[j] && ch === guess[i]);
      if(idx !== -1){ result[i] = 'yellow'; used[idx]=true; }
    }
    return result;
  }

  function renderAttempts(){
    const list = el('attemptsList');
    list.innerHTML = '';
    for(const a of attempts){
      const row = document.createElement('div');
      row.className = 'attempt';
      // show guess characters as keys with colors
      for(let i=0;i<a.guess.length;i++){
        const k = document.createElement('div');
        k.className = 'key ' + (a.marks[i] || 'gray');
        k.textContent = a.guess[i];
        row.appendChild(k);
      }
      // info text
      const info = document.createElement('div');
      info.style.marginLeft = '8px';
      info.style.fontSize = '13px';
      info.style.color = 'var(--muted)';
      info.textContent = `Attempt ${a.index}/${maxAttempts}`;
      row.appendChild(info);
      list.appendChild(row);
    }
  }

  function finishGame(win){
    finished = true;
    el('revealBtn').disabled = true;
    stats.played += 1;
    if(win){
      stats.won += 1;
      const used = attempts.length;
      if(stats.best === null || used < stats.best) stats.best = used;
      el('hintLine').textContent = `You cracked it in ${used} attempt(s)! Secret: ${secret}`;
    } else {
      el('hintLine').textContent = `Out of attempts. The password was: ${secret}`;
    }
    writeStats(stats);
    refreshStatsUI();
  }

  // Event handlers
  el('submitBtn').addEventListener('click', submitGuess);
  el('guessInput').addEventListener('keydown', (e)=>{
    if(e.key === 'Enter') { submitGuess(); }
  });

  el('newGameBtn').addEventListener('click', ()=> resetGame({diff: el('difficulty').value}));
  el('revealBtn').addEventListener('click', ()=>{
    if(finished) return;
    if(!confirm('Reveal the password? This counts as a loss.')) return;
    finishGame(false);
  });
  el('maxAttempts').addEventListener('input', (e)=>{
    el('maxAttemptsLabel').textContent = e.target.value;
    el('attemptsLeft').textContent = `${e.target.value - attempts.length} left`;
  });
  el('difficulty').addEventListener('change', ()=>{
    el('hintLine').textContent = `Difficulty set to ${el('difficulty').value}. Click New Game to start.`;
  });

  el('copyStateBtn').addEventListener('click', ()=>{
    const state = {
      difficulty, secretLength: secret.length, attempts: attempts.map(a=>({guess:a.guess, marks:a.marks}))
    };
    navigator.clipboard?.writeText(JSON.stringify(state,null,2)).then(()=> alert('Game state copied to clipboard'));
  });

  el('resetStatsBtn').addEventListener('click', ()=>{
    if(confirm('Reset your local stats?')) {
      localStorage.removeItem(STATS_KEY);
      const s = readStats();
      stats.played = s.played; stats.won = s.won; stats.best = s.best;
      refreshStatsUI();
    }
  });

  function submitGuess(){
    if(finished) {
      alert('Game over. Start a new game to play again.');
      return;
    }
    const raw = el('guessInput').value.trim();
    if(!raw){
      alert('Please enter a guess.');
      return;
    }
    // Accept guesses by length equal to secret
    if(raw.length !== secret.length){
      alert(`Your guess must be ${secret.length} characters long.`);
      return;
    }
    const guess = raw;
    const marks = evaluateGuess(guess, secret);
    attempts.push({guess, marks, index: attempts.length+1});
    renderAttempts();
    el('guessInput').value = '';
    const left = maxAttempts - attempts.length;
    el('attemptsLeft').textContent = left >= 0 ? `${left} left` : `0 left`;

    // Check win
    if(marks.every(m=>m==='green')){
      finishGame(true);
      return;
    }
    if(attempts.length >= maxAttempts){
      finishGame(false);
    }
  }

  // Init
  refreshStatsUI();
  resetGame();

  // Small accessibility: focus input
  el('guessInput').focus();
})();
</script>
</body>
</html>
